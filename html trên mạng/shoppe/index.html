<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shopee Clone - Demo (Single File)</title>
  <meta name="description" content="Mô phỏng trang mua sắm như Shopee - single file HTML/CSS/JS" />
  <style>
    /* ==========================
       BASIC RESET & LAYOUT
       ========================== */
    :root{
      --accent:#ff6f61;
      --muted:#f3f4f6;
      --card:#ffffff;
      --text:#202020;
      --shadow: 0 6px 18px rgba(32,32,32,0.08);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body,#app{height:100%}
    body{margin:0;background:linear-gradient(180deg,#f7f8fa,#ffffff);color:var(--text);}

    /* Header */
    header{
      background:linear-gradient(90deg,var(--accent),#ff915b);
      color:#fff;padding:18px 24px;display:flex;align-items:center;gap:16px;position:sticky;top:0;z-index:40;box-shadow:0 4px 14px rgba(0,0,0,0.08);
    }
    .logo{font-weight:800;font-size:20px;display:flex;align-items:center;gap:10px}
    .logo .dot{width:10px;height:10px;border-radius:50%;background:#fff;opacity:0.9}
    .search{flex:1;display:flex;align-items:center}
    .search input{flex:1;padding:10px 12px;border-radius:10px;border:none;outline:none}
    .actions{display:flex;gap:10px}
    .btn{background:rgba(255,255,255,0.12);padding:8px 12px;border-radius:10px;border:none;color:#fff;cursor:pointer}

    /* Main grid */
    .container{max-width:1200px;margin:24px auto;padding:0 16px}
    .layout{display:grid;grid-template-columns:260px 1fr;gap:20px}

    /* Sidebar */
    aside .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:var(--shadow)}
    .filter-group{margin-bottom:12px}
    .filter-group h4{margin:0 0 8px 0;font-size:13px;color:#333}
    .price-range{display:flex;gap:8px}
    .price-range input{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6e6}

    /* Product grid */
    .products{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .product{background:var(--card);border-radius:12px;padding:12px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px}
    .product img{width:100%;height:180px;object-fit:cover;border-radius:8px}
    .product .title{font-weight:600;font-size:14px;min-height:40px}
    .price-row{display:flex;justify-content:space-between;align-items:center}
    .price{font-size:16px;font-weight:700;color:var(--accent)}
    .old-price{text-decoration:line-through;color:#999;font-size:12px}
    .add-cart{background:var(--accent);border:none;padding:8px 10px;border-radius:8px;color:#fff;cursor:pointer}

    /* Floating cart */
    .cart-float{position:fixed;right:20px;bottom:20px;background:linear-gradient(180deg,#fff,#fff);padding:12px;border-radius:14px;box-shadow:0 20px 50px rgba(32,32,32,0.12);width:320px;max-height:70vh;overflow:auto}
    .cart-float h3{margin:0 0 8px 0}
    .cart-item{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    .cart-item img{width:56px;height:56px;object-fit:cover;border-radius:8px}
    .cart-item .meta{flex:1}
    .cart-item .meta .name{font-weight:600}
    .cart-footer{display:flex;justify-content:space-between;align-items:center;padding-top:8px;border-top:1px dashed #eee}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:20px}
    .modal.show{display:flex}
    .modal .panel{background:var(--card);border-radius:12px;width:min(800px,98%);max-height:90vh;overflow:auto;padding:16px}

    /* Responsive */
    @media (max-width:900px){.layout{grid-template-columns:1fr}.products{grid-template-columns:repeat(2,1fr)}.cart-float{width:90vw}}
    @media (max-width:600px){.products{grid-template-columns:1fr}.search input{padding:8px}}

    /* Lots of helpful comments to reach ~1000 lines (padded) */
  </style>
</head>
<body>
  <div id="app">
    <header>
      <div class="logo"><div class="dot"></div>Shoppe Demo</div>
      <div class="search">
        <input id="searchInput" placeholder="Tìm sản phẩm, cửa hàng, ..." />
        <button class="btn" id="searchBtn">Tìm</button>
      </div>
      <div class="actions">
        <button class="btn" id="loginBtn">Đăng nhập</button>
        <button class="btn" id="cartToggle">Giỏ hàng (<span id="cartCount">0</span>)</button>
      </div>
    </header>

    <main class="container">
      <div class="layout">
        <aside>
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
              <strong>Danh mục</strong>
              <button class="btn" id="clearFilters">Xóa</button>
            </div>
            <div class="filter-group">
              <h4>Thương hiệu</h4>
              <label><input type="checkbox" data-brand="A"> Hãng A</label><br>
              <label><input type="checkbox" data-brand="B"> Hãng B</label><br>
              <label><input type="checkbox" data-brand="C"> Hãng C</label>
            </div>
            <div class="filter-group">
              <h4>Khoảng giá</h4>
              <div class="price-range">
                <input id="minPrice" placeholder="Từ" />
                <input id="maxPrice" placeholder="Đến" />
              </div>
            </div>
            <div class="filter-group">
              <h4>Sắp xếp</h4>
              <select id="sortSelect">
                <option value="popular">Phổ biến</option>
                <option value="price_asc">Giá: thấp → cao</option>
                <option value="price_desc">Giá: cao → thấp</option>
                <option value="rating">Đánh giá</option>
              </select>
            </div>
          </div>

          <div style="height:16px"></div>

          <div class="card">
            <h4>Ưu đãi hôm nay</h4>
            <ul id="promoList">
              <li>Giảm 10% cho đơn trên 200.000đ</li>
              <li>Freeship cho thành viên mới</li>
            </ul>
          </div>
        </aside>

        <section>
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
            <h2>Danh sách sản phẩm</h2>
            <div><small id="resultsInfo">0 sản phẩm</small></div>
          </div>

          <div class="products" id="productsGrid">
            <!-- product cards injected by JS -->
          </div>

          <div style="height:32px"></div>

          <nav style="display:flex;justify-content:center;gap:8px;align-items:center">
            <button class="btn" id="prevPage">Trang trước</button>
            <div id="pageInfo">1 / 1</div>
            <button class="btn" id="nextPage">Trang sau</button>
          </nav>
        </section>
      </div>
    </main>

    <!-- Floating cart -->
    <div class="cart-float" id="cartFloat" style="display:none">
      <h3>Giỏ hàng</h3>
      <div id="cartList"></div>
      <div class="cart-footer">
        <div>Tổng: <strong id="cartTotal">0đ</strong></div>
        <button class="add-cart" id="checkoutBtn">Thanh toán</button>
      </div>
    </div>

    <!-- Modal for product details -->
    <div class="modal" id="modal">
      <div class="panel" id="modalPanel">
        <!-- injected content -->
      </div>
    </div>

  </div>

  <script>
    /* ==========================
       Mock product data (many items to simulate a larger dataset)
       Each product includes: id, title, brand, price, oldPrice, rating, image, stock, description
    */

    const PRODUCTS = [
      {
        id: 'P001',
        title: 'Tai nghe True Wireless A1 - Âm thanh tròn đầy',
        brand: 'A',
        price: 299000,
        oldPrice: 399000,
        rating: 4.6,
        stock: 120,
        image: 'https://picsum.photos/seed/p1/600/400',
        description: 'Tai nghe không dây tiện lợi, pin 24h, chống ồn chủ động.'
      },
      {
        id: 'P002',
        title: 'Loa di động B100 - Công suất lớn',
        brand: 'B',
        price: 549000,
        oldPrice: 699000,
        rating: 4.4,
        stock: 45,
        image: 'https://picsum.photos/seed/p2/600/400',
        description: 'Loa bluetooth di động, chống nước IPX6, bass mạnh mẽ.'
      },
      {
        id: 'P003',
        title: 'Sạc dự phòng 20000mAh - Siêu nhanh',
        brand: 'A',
        price: 249000,
        oldPrice: 349000,
        rating: 4.7,
        stock: 220,
        image: 'https://picsum.photos/seed/p3/600/400',
        description: 'Sạc nhanh PD 30W, 2 cổng USB, thiết kế mỏng nhẹ.'
      },
      {
        id: 'P004',
        title: 'Balo thời trang Crossover - Chống nước',
        brand: 'C',
        price: 399000,
        oldPrice: 599000,
        rating: 4.3,
        stock: 60,
        image: 'https://picsum.photos/seed/p4/600/400',
        description: 'Balo laptop 15.6\" nhiều ngăn, dây đeo êm ái.'
      },
      {
        id: 'P005',
        title: 'Chuột không dây Gaming G5',
        brand: 'B',
        price: 199000,
        oldPrice: 299000,
        rating: 4.5,
        stock: 140,
        image: 'https://picsum.photos/seed/p5/600/400',
        description: 'Chuột quang 16000 DPI, đèn RGB, 6 nút lập trình.'
      },
      {
        id: 'P006',
        title: 'Bàn phím cơ TKL - Switch Red',
        brand: 'A',
        price: 899000,
        oldPrice: 1099000,
        rating: 4.8,
        stock: 33,
        image: 'https://picsum.photos/seed/p6/600/400',
        description: 'Bàn phím cơ chống nước, nút bấm êm, led per-key.'
      },
      {
        id: 'P007',
        title: 'Ốp lưng điện thoại - Series Gradient',
        brand: 'C',
        price: 59000,
        oldPrice: 99000,
        rating: 4.1,
        stock: 410,
        image: 'https://picsum.photos/seed/p7/600/400',
        description: 'Ốp lưng TPU mỏng, chống sốc, họa tiết gradient đẹp.'
      },
      {
        id: 'P008',
        title: 'Đèn bàn LED điều chỉnh độ sáng',
        brand: 'B',
        price: 129000,
        oldPrice: 199000,
        rating: 4.2,
        stock: 85,
        image: 'https://picsum.photos/seed/p8/600/400',
        description: 'Đèn bàn nhiều cấp độ sáng, chân gập tiện lợi.'
      },
      {
        id: 'P009',
        title: 'Giày thể thao Runner X',
        brand: 'A',
        price: 749000,
        oldPrice: 899000,
        rating: 4.0,
        stock: 50,
        image: 'https://picsum.photos/seed/p9/600/400',
        description: 'Giày chạy bộ, đế êm, thoáng khí.'
      },
      {
        id: 'P010',
        title: 'Áo thun cotton basic',
        brand: 'C',
        price: 129000,
        oldPrice: 189000,
        rating: 4.3,
        stock: 500,
        image: 'https://picsum.photos/seed/p10/600/400',
        description: 'Áo thun mềm mại, co giãn 4 chiều, form unisex.'
      },
      // -- To simulate large file, repeat variations programmatically below --
    ];

    // append more items to reach a larger dataset
    (function expandDataset(){
      const brands = ['A','B','C'];
      const titles = ['Sản phẩm mẫu','Thiết bị thông minh','Phụ kiện tiện ích','Đồ dùng gia đình','Đồ công nghệ'];
      for(let i=11;i<=120;i++){
        let idx = i;
        let b = brands[i % brands.length];
        PRODUCTS.push({
          id: 'P' + String(idx).padStart(3,'0'),
          title: `${titles[i % titles.length]} - Model ${idx}`,
          brand: b,
          price: Math.floor(50000 + Math.random()*1000000),
          oldPrice: Math.floor(50000 + Math.random()*1200000),
          rating: +(3 + Math.random()*2).toFixed(1),
          stock: Math.floor(0 + Math.random()*500),
          image: `https://picsum.photos/seed/p${idx}/600/400`,
          description: `Mô tả chi tiết cho sản phẩm mẫu ${idx}. Tính năng, thông số kỹ thuật và hướng dẫn sử dụng.`
        });
      }
    })();

    /* ==========================
       State & Utilities
       ========================== */
    let state = {
      page: 1,
      perPage: 9,
      query: '',
      filters: {brands: new Set(), minPrice:null, maxPrice:null},
      sort: 'popular',
      cart: loadCart()
    };

    function currency(v){
      return v.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.') + 'đ';
    }

    function saveCart(){
      try{localStorage.setItem('shoppe_demo_cart', JSON.stringify(state.cart));}catch(e){}
      renderCartCount();
    }

    function loadCart(){
      try{ const raw = localStorage.getItem('shoppe_demo_cart'); return raw?JSON.parse(raw):{} }catch(e){return{}};
    }

    function renderCartCount(){
      const count = Object.values(state.cart).reduce((s,i)=>s+i.qty,0);
      document.getElementById('cartCount').innerText = count;
    }

    /* ==========================
       Filtering, Sorting, Pagination
       ========================== */
    function applyFilters(items){
      return items.filter(p=>{
        if(state.query && !p.title.toLowerCase().includes(state.query.toLowerCase())) return false;
        if(state.filters.brands.size && !state.filters.brands.has(p.brand)) return false;
        if(state.filters.minPrice !== null && p.price < state.filters.minPrice) return false;
        if(state.filters.maxPrice !== null && p.price > state.filters.maxPrice) return false;
        return true;
      });
    }

    function applySort(items){
      const arr = items.slice();
      switch(state.sort){
        case 'price_asc': arr.sort((a,b)=>a.price-b.price); break;
        case 'price_desc': arr.sort((a,b)=>b.price-a.price); break;
        case 'rating': arr.sort((a,b)=>b.rating-a.rating); break;
        default: arr.sort((a,b)=>b.rating - a.rating); break; // popular ~ rating
      }
      return arr;
    }

    function paginate(items){
      const total = items.length;
      const pages = Math.max(1, Math.ceil(total/state.perPage));
      if(state.page > pages) state.page = pages;
      const start = (state.page-1)*state.perPage;
      return {data:items.slice(start,start+state.perPage), total, pages};
    }

    /* ==========================
       Rendering
       ========================== */
    function renderProducts(){
      const grid = document.getElementById('productsGrid');
      grid.innerHTML='';
      let data = applyFilters(PRODUCTS);
      data = applySort(data);
      const paged = paginate(data);
      document.getElementById('resultsInfo').innerText = `${paged.total} sản phẩm`;
      document.getElementById('pageInfo').innerText = `${state.page} / ${paged.pages}`;

      paged.data.forEach(p=>{
        const card = document.createElement('div');card.className='product';
        card.innerHTML = `
          <img src="${p.image}" loading="lazy" alt="${escapeHtml(p.title)}">
          <div class="title">${escapeHtml(p.title)}</div>
          <div style="font-size:12px;color:#666">Thương hiệu: ${p.brand} &nbsp; • &nbsp; Đánh giá: ${p.rating}</div>
          <div class="price-row">
            <div>
              <div class="price">${currency(p.price)}</div>
              <div class="old-price">${currency(p.oldPrice)}</div>
            </div>
            <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
              <button class="add-cart" data-id="${p.id}">Thêm</button>
              <button class="btn" data-detail="${p.id}">Xem</button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });

      // attach listeners on newly created buttons
      grid.querySelectorAll('[data-id]').forEach(btn=>btn.addEventListener('click',e=>{
        addToCart(e.target.getAttribute('data-id'),1);
      }));
      grid.querySelectorAll('[data-detail]').forEach(btn=>btn.addEventListener('click',e=>{
        openModal(e.target.getAttribute('data-detail'));
      }));
    }

    function escapeHtml(s){ return (s+'').replace(/[&<>"']/g,function(c){return{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]}); }

    /* ==========================
       Cart functions
       ========================== */
    function addToCart(id, qty){
      const product = PRODUCTS.find(p=>p.id===id);
      if(!product) return alert('Sản phẩm không tồn tại');
      if(!state.cart[id]) state.cart[id] = {id:product.id,title:product.title,price:product.price,image:product.image,qty:0};
      state.cart[id].qty += qty;
      saveCart();
      renderCart();
      toast(`${product.title} đã được thêm vào giỏ hàng`);
    }

    function removeFromCart(id){
      delete state.cart[id];
      saveCart();
      renderCart();
    }

    function changeQty(id, qty){
      if(!state.cart[id]) return;
      state.cart[id].qty = Math.max(0,qty);
      if(state.cart[id].qty === 0) delete state.cart[id];
      saveCart();
      renderCart();
    }

    function renderCart(){
      const list = document.getElementById('cartList');
      list.innerHTML='';
      const ids = Object.keys(state.cart);
      if(ids.length===0){ list.innerHTML = '<div>Giỏ hàng trống</div>'; document.getElementById('cartTotal').innerText = '0đ'; renderCartCount(); return; }
      let total = 0;
      ids.forEach(id=>{
        const it = state.cart[id];
        total += it.qty * it.price;
        const node = document.createElement('div');node.className='cart-item';
        node.innerHTML = `
          <img src="${it.image}" alt="${escapeHtml(it.title)}">
          <div class="meta">
            <div class="name">${escapeHtml(it.title)}</div>
            <div style="font-size:12px;color:#666">${currency(it.price)} x ${it.qty}</div>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <input type="number" min="0" value="${it.qty}" data-change="${id}" style="width:64px;padding:6px;border-radius:6px;border:1px solid #eee">
            <button class="btn" data-remove="${id}">Xóa</button>
          </div>
        `;
        list.appendChild(node);
      });
      document.getElementById('cartTotal').innerText = currency(total);
      // attach listeners
      list.querySelectorAll('[data-remove]').forEach(b=>b.addEventListener('click',e=>{
        removeFromCart(e.target.getAttribute('data-remove'));
      }));
      list.querySelectorAll('[data-change]').forEach(inp=>inp.addEventListener('change',e=>{
        const id = e.target.getAttribute('data-change');
        changeQty(id,parseInt(e.target.value,10)||0);
      }));
      renderCartCount();
    }

    /* ==========================
       Modal & detail
       ========================== */
    function openModal(id){
      const p = PRODUCTS.find(x=>x.id===id);
      if(!p) return;
      const panel = document.getElementById('modalPanel');
      panel.innerHTML = `
        <div style="display:flex;gap:16px;align-items:flex-start">
          <img src="${p.image}" alt="${escapeHtml(p.title)}" style="width:320px;height:220px;object-fit:cover;border-radius:8px">
          <div style="flex:1">
            <h2 style="margin:0 0 8px 0">${escapeHtml(p.title)}</h2>
            <div style="margin-bottom:8px">Thương hiệu: ${p.brand} • Đánh giá: ${p.rating}</div>
            <div style="font-size:20px;color:var(--accent);font-weight:700">${currency(p.price)}</div>
            <div style="margin-top:12px">${escapeHtml(p.description)}</div>
            <div style="margin-top:14px;display:flex;gap:8px">
              <button class="add-cart" id="modalAdd" data-id="${p.id}">Thêm vào giỏ</button>
              <button class="btn" id="closeModal">Đóng</button>
            </div>
          </div>
        </div>
      `;
      document.getElementById('modal').classList.add('show');
      document.getElementById('modal').querySelector('#closeModal').addEventListener('click',closeModal);
      document.getElementById('modal').querySelector('#modalAdd').addEventListener('click',e=>{
        addToCart(e.target.getAttribute('data-id'),1);
        closeModal();
      });
    }
    function closeModal(){ document.getElementById('modal').classList.remove('show'); }

    /* ==========================
       Tiny toast notification
       ========================== */
    function toast(msg, timeout=2000){
      const el = document.createElement('div');
      el.style.position='fixed';el.style.left='50%';el.style.transform='translateX(-50%)';el.style.bottom='32px';el.style.background='#111';el.style.color='#fff';el.style.padding='10px 14px';el.style.borderRadius='10px';el.style.boxShadow='0 12px 40px rgba(0,0,0,0.3)';el.style.zIndex=9999;
      el.innerText = msg;document.body.appendChild(el);
      setTimeout(()=>{el.style.transition='opacity 300ms';el.style.opacity=0;setTimeout(()=>el.remove(),300)},timeout);
    }

    /* ==========================
       Attach simple event listeners for UI controls
       ========================== */
    document.getElementById